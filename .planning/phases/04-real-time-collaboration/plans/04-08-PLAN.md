---
phase: 04-real-time-collaboration
plan: 08
type: execute
wave: 1
depends_on: []
gap_closure: true
files_modified:
  - apps/portal/src/components/DocumentWorkspace.tsx
  - apps/portal/src/components/ShareButton.tsx
autonomous: false

must_haves:
  truths:
    - "ShareButton is visible in main editor toolbar"
    - "ShareButton generates /shared/{slug} link"
    - "ShareButton copies link to clipboard"
    - "Users can share from main editor (not just from SharedDocument page)"
  artifacts:
    - path: "apps/portal/src/components/DocumentWorkspace.tsx"
      provides: "Main editor with share button in toolbar"
      min_lines: 150
    - path: "apps/portal/src/components/ShareButton.tsx"
      provides: "Share button with copy-to-clipboard (already exists)"
      min_lines: 60
  key_links:
    - from: "apps/portal/src/components/DocumentWorkspace.tsx"
      to: "apps/portal/src/components/ShareButton"
      via: "import"
      pattern: "ShareButton"
---

<objective>
Integrate ShareButton into DocumentWorkspace toolbar so users can share documents from the main editor.

**Purpose:** Close COLL-03 gap - ShareButton component exists but is not integrated into main editor.

**Output:** Share button in main editor toolbar that generates shareable links.
</objective>

<execution_context>
@C:\Users\Alex\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Alex\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
Gap from VERIFICATION.md:
- COLL-03 is VERIFIED for SharedDocument page
- But ShareButton is NOT integrated into DocumentWorkspace (main editor)
- Users cannot share from main editor - they can only access sharing via /shared/{slug} URLs

Existing components:
- apps/portal/src/components/ShareButton.tsx (exists from 04-05)
- apps/portal/src/lib/slugGenerator.ts (exists from 04-05)
- apps/portal/src/lib/supabase/sharing.ts (exists from 04-05)

Locked decisions from CONTEXT.md deferred section:
- Sharing system was deferred but COLL-03 is a CORE requirement
- Share button should be easily accessible in the editor
</context>

<tasks>

<task type="auto">
  <name>Integrate ShareButton into DocumentWorkspace toolbar</name>
  <files>apps/portal/src/components/DocumentWorkspace.tsx</files>
  <action>
    Add ShareButton to the DocumentWorkspace toolbar:

    1. Add import:
    ```typescript
    import { ShareButton } from "@/components/ShareButton";
    ```

    2. Add ShareButton to toolbar/header section:
    ```typescript
    export function DocumentWorkspace({ documentId, ...props }: DocumentWorkspaceProps) {
      return (
        <div className="document-workspace">
          {/* Toolbar/Header */}
          <div className="workspace-header">
            <div className="header-title">
              {/* Document title */}
            </div>

            <div className="header-actions">
              {/* Share button - add near other actions */}
              <ShareButton documentId={documentId} />

              {/* Existing buttons like save, settings, etc. */}
            </div>
          </div>

          {/* Rest of workspace */}
        </div>
      );
    }
    ```

    Position the ShareButton logically - near other document actions like save, export, etc.
    Use appropriate spacing and styling to match existing toolbar.
  </action>
  <verify>DocumentWorkspace imports and renders ShareButton with documentId prop</verify>
  <done>ShareButton integrated into main editor</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Share button in main editor toolbar</what-built>
  <how-to-verify>
    1. Start portal: cd apps/portal && bun run dev

    2. Open a document in the main editor

    3. Locate the Share button in the toolbar

    4. Click the Share button:
       - Verify button shows "Gerando link..." state
       - Verify button changes to "Link copiado!"
       - Verify clipboard contains URL like http://localhost:5173/shared/AbCd1234Ef

    5. Open incognito window and paste the share URL:
       - Verify SharedDocument page loads
       - Verify document content displays
       - Verify guest banner appears

    6. Click Share button again on same document:
       - Verify reuses same slug (doesn't create duplicate)

    Expected outcomes:
    - Share button is visible and accessible in main editor
    - Generates unique shareable links
    - Copies to clipboard
    - /shared/{slug} route works for guests
  </how-to-verify>
  <resume-signal>Type "approved" if sharing from main editor works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] DocumentWorkspace imports ShareButton
- [ ] ShareButton rendered in toolbar/header
- [ ] ShareButton receives documentId prop
- [ ] Button is visible and accessible in main editor UI
- [ ] Clicking button generates share link
- [ ] Link copies to clipboard
- [ ] /shared/{slug} route works
</verification>

<success_criteria>
1. Users can share from main editor toolbar
2. Share button generates unique slug-based URLs
3. Link copies to clipboard
4. COLL-03 fully satisfied for main editor
</success_criteria>

<output>
After completion, create `.planning/phases/04-real-time-collaboration/plans/04-08-SUMMARY.md`
</output>

---

**Plan created:** 2026-02-07
**Estimated duration:** 15 min
**Complexity:** Low (Simple component integration)
