# 13-06: Separate Hardcoded Portuguese Strings into i18n System

## Goal
Implement internationalization (i18n) system to support multiple languages.

## Requirements
- QUAL-06: Hardcoded Portuguese strings separated into i18n system

## Success Criteria
1. All hardcoded strings moved to translation files
2. Portuguese (pt-BR) as default language
3. English (en-US) translations provided
4. Language switcher in settings
5. Translations loaded dynamically
6. Date/time formatting localized

## Implementation

### Install i18n Library
```bash
bun add i18next react-i18next i18next-browser-languagedetector
```

### Configure i18next
```typescript
// packages/core/src/i18n/config.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import ptBR from './locales/pt-BR.json';
import enUS from './locales/en-US.json';

const resources = {
  'pt-BR': { translation: ptBR },
  'en-US': { translation: enUS },
};

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'pt-BR',
    lng: 'pt-BR',
    debug: false,
    interpolation: {
      escapeValue: false,
    },
  });

export default i18n;
```

### Translation Files Structure
```
packages/core/src/i18n/locales/
â”œâ”€â”€ pt-BR.json (Portuguese - Default)
â”œâ”€â”€ en-US.json (English)
â””â”€â”€ index.ts
```

### Translation Keys (Portuguese)
```json
// packages/core/src/i18n/locales/pt-BR.json
{
  "common": {
    "loading": "Carregando...",
    "saving": "Salvando...",
    "error": "Erro",
    "success": "Sucesso",
    "cancel": "Cancelar",
    "confirm": "Confirmar",
    "delete": "Excluir",
    "edit": "Editar",
    "save": "Salvar",
    "close": "Fechar",
    "search": "Buscar",
    "filter": "Filtrar",
    "actions": "AÃ§Ãµes",
    "back": "Voltar",
    "next": "PrÃ³ximo",
    "previous": "Anterior",
    "submit": "Enviar"
  },

  "auth": {
    "signIn": "Entrar",
    "signUp": "Cadastrar",
    "signOut": "Sair",
    "email": "Email",
    "password": "Senha",
    "forgotPassword": "Esqueci minha senha",
    "resetPassword": "Redefinir senha",
    "sessionExpired": "Sua sessÃ£o expirou. FaÃ§a login novamente.",
    "invalidCredentials": "Email ou senha incorretos.",
    "welcomeBack": "Bem-vindo de volta!"
  },

  "annotation": {
    "title": "AnotaÃ§Ãµes",
    "add": "Adicionar AnotaÃ§Ã£o",
    "edit": "Editar AnotaÃ§Ã£o",
    "delete": "Excluir AnotaÃ§Ã£o",
    "none": "Nenhuma anotaÃ§Ã£o ainda",
    "empty": "Adicione anotaÃ§Ãµes ao documento para comeÃ§ar a revisar",
    "status": {
      "open": "Aberta",
      "inProgress": "Em Progresso",
      "resolved": "Resolvida"
    }
  },

  "document": {
    "title": "Documento",
    "create": "Criar Documento",
    "delete": "Excluir Documento",
    "share": "Compartilhar",
    "settings": "ConfiguraÃ§Ãµes",
    "versions": "HistÃ³rico de VersÃµes"
  },

  "settings": {
    "title": "ConfiguraÃ§Ãµes",
    "profile": "Perfil",
    "appearance": "AparÃªncia",
    "annotations": "AnotaÃ§Ãµes",
    "integrations": "IntegraÃ§Ãµes",
    "billing": "Assinatura",
    "language": "Idioma",
    "theme": "Tema",
    "theme_light": "Claro",
    "theme_dark": "Escuro",
    "theme_system": "Sistema"
  },

  "subscription": {
    "tier": {
      "free": "Gratuito",
      "pro": "Pro"
    },
    "upgrade": "Fazer upgrade para Pro",
    "manage": "Gerenciar assinatura",
    "cancel": "Cancelar assinatura"
  },

  "errors": {
    "network": "Erro de conexÃ£o. Verifique sua internet.",
    "timeout": "A operaÃ§Ã£o demorou muito. Tente novamente.",
    "offline": "VocÃª estÃ¡ offline. Verifique sua conexÃ£o.",
    "unauthorized": "VocÃª nÃ£o tem permissÃ£o para acessar este recurso.",
    "notFound": "PÃ¡gina nÃ£o encontrada.",
    "serverError": "Erro no servidor. Tente novamente mais tarde."
  },

  "validation": {
    "required": "Este campo Ã© obrigatÃ³rio.",
    "email": "Email invÃ¡lido.",
    "minLength": "Muito curto. MÃ­nimo: {{min}} caracteres.",
    "maxLength": "Muito longo. MÃ¡ximo: {{max}} caracteres."
  }
}
```

### Translation Keys (English)
```json
// packages/core/src/i18n/locales/en-US.json
{
  "common": {
    "loading": "Loading...",
    "saving": "Saving...",
    "error": "Error",
    "success": "Success",
    "cancel": "Cancel",
    "confirm": "Confirm",
    "delete": "Delete",
    "edit": "Edit",
    "save": "Save",
    "close": "Close",
    "search": "Search",
    "filter": "Filter",
    "actions": "Actions",
    "back": "Back",
    "next": "Next",
    "previous": "Previous",
    "submit": "Submit"
  },

  "auth": {
    "signIn": "Sign In",
    "signUp": "Sign Up",
    "signOut": "Sign Out",
    "email": "Email",
    "password": "Password",
    "forgotPassword": "Forgot password?",
    "resetPassword": "Reset password",
    "sessionExpired": "Your session has expired. Please log in again.",
    "invalidCredentials": "Invalid email or password.",
    "welcomeBack": "Welcome back!"
  },

  "annotation": {
    "title": "Annotations",
    "add": "Add Annotation",
    "edit": "Edit Annotation",
    "delete": "Delete Annotation",
    "none": "No annotations yet",
    "empty": "Add annotations to the document to start reviewing",
    "status": {
      "open": "Open",
      "inProgress": "In Progress",
      "resolved": "Resolved"
    }
  },

  "document": {
    "title": "Document",
    "create": "Create Document",
    "delete": "Delete Document",
    "share": "Share",
    "settings": "Settings",
    "versions": "Version History"
  },

  "settings": {
    "title": "Settings",
    "profile": "Profile",
    "appearance": "Appearance",
    "annotations": "Annotations",
    "integrations": "Integrations",
    "billing": "Subscription",
    "language": "Language",
    "theme": "Theme",
    "theme_light": "Light",
    "theme_dark": "Dark",
    "theme_system": "System"
  },

  "subscription": {
    "tier": {
      "free": "Free",
      "pro": "Pro"
    },
    "upgrade": "Upgrade to Pro",
    "manage": "Manage subscription",
    "cancel": "Cancel subscription"
  },

  "errors": {
    "network": "Connection error. Check your internet.",
    "timeout": "Operation timed out. Please try again.",
    "offline": "You are offline. Check your connection.",
    "unauthorized": "You don't have permission to access this resource.",
    "notFound": "Page not found.",
    "serverError": "Server error. Please try again later."
  },

  "validation": {
    "required": "This field is required.",
    "email": "Invalid email.",
    "minLength": "Too short. Minimum: {{min}} characters.",
    "maxLength": "Too long. Maximum: {{max}} characters."
  }
}
```

### Hook for Translations
```typescript
// packages/ui/src/hooks/useTranslation.ts
import { useTranslation } from 'react-i18next';

export function useT() {
  const { t, i18n } = useTranslation();

  return {
    t,
    changeLanguage: (lng: string) => i18n.changeLanguage(lng),
    currentLanguage: i18n.language,
  };
}
```

### Usage in Components
```typescript
// Before
<button>Salvar</button>

// After
import { useT } from '@obsidian-note-reviewer/ui/hooks/useTranslation';

function MyComponent() {
  const { t } = useT();

  return <button>{t('common.save')}</button>;
}
```

### Language Switcher
```typescript
// packages/ui/src/components/LanguageSwitcher.tsx
import { useT } from '@obsidian-note-reviewer/ui/hooks/useTranslation';

const languages = [
  { code: 'pt-BR', name: 'PortuguÃªs', flag: 'ðŸ‡§ðŸ‡·' },
  { code: 'en-US', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
];

export function LanguageSwitcher() {
  const { currentLanguage, changeLanguage } = useT();

  return (
    <div className="flex items-center gap-2">
      {languages.map((lang) => (
        <button
          key={lang.code}
          onClick={() => changeLanguage(lang.code)}
          className={cn(
            'px-3 py-2 text-sm rounded-lg transition-colors',
            currentLanguage === lang.code
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
          )}
        >
          <span className="mr-2">{lang.flag}</span>
          {lang.name}
        </button>
      ))}
    </div>
  );
}
```

### Date/Time Localization
```typescript
// packages/core/src/utils/dateFormat.ts
import { format } from 'date-fns';
import { ptBR } from 'date-fns/locale/pt-BR';
import { enUS } from 'date-fns/locale/en-US';

const locales = {
  'pt-BR': ptBR,
  'en-US': enUS,
};

export function formatDate(date: Date, language: string, formatStr: string = 'PPP') {
  return format(date, formatStr, {
    locale: locales[language as keyof typeof locales] || ptBR,
  });
}

// Usage
formatDate(new Date(), 'pt-BR'); // "5 de fevereiro de 2026"
formatDate(new Date(), 'en-US'); // "February 5, 2026"
```

## Migration Strategy

### Phase 1: Setup
1. Install i18next dependencies
2. Create translation files
3. Configure i18next

### Phase 2: Extract Common Strings
1. Create translation keys for common words
2. Replace in buttons, labels, etc.

### Phase 3: Extract Component Strings
1. Go through each component
2. Extract strings to translation files
3. Replace with t() calls

### Phase 4: Add Language Switcher
1. Add to settings page
2. Persist to localStorage

## Files to Create
- `packages/core/src/i18n/config.ts` - i18n configuration
- `packages/core/src/i18n/locales/pt-BR.json` - Portuguese translations
- `packages/core/src/i18n/locales/en-US.json` - English translations
- `packages/ui/src/hooks/useTranslation.ts` - Translation hook
- `packages/ui/src/components/LanguageSwitcher.tsx` - Language selector
- `packages/core/src/utils/dateFormat.ts` - Date localization

## Files to Modify
- All components with hardcoded strings

## Best Practices

### Translation Key Naming
- Use namespaces: `namespace.key`
- Use dots for hierarchy: `settings.theme.dark`
- Use camelCase for keys

### Interpolation
```typescript
// In translation file
"welcome": "Bem-vindo, {{name}}!"

// In component
t('auth.welcome', { name: userName })
```

### Plurals
```typescript
// In translation file
"count_annotations": "Uma anotaÃ§Ã£o",
"count_annotations_plural": "{{count}} anotaÃ§Ãµes"

// In component
t('annotation.count', { count: annotations.length })
```

## Notes
- Start with pt-BR as default (current language)
- Add en-US for international users
- More languages can be added later
- Translation files loaded dynamically
- Language preference persisted in localStorage
