# 10-02: Integrate Stripe Checkout for Subscription Payments

## Goal
Integrate Stripe checkout to process monthly subscription payments for the Pro tier.

## Requirements
- MONY-03: Stripe checkout process processes payments correctly
- MONY-02: Paid tier enables unlimited collaborators with subscription billing

## Success Criteria
1. User can initiate Stripe checkout from upgrade prompt
2. Stripe checkout page loads correctly with product details
3. Successful payment updates user to Pro tier
4. Failed/cancelled payments handle gracefully
5. Pricing page displays subscription options clearly

## Implementation Plan

### 1. Install Stripe Dependencies
```bash
bun add @stripe/stripe-js @stripe/react-stripe-js
```

### 2. Create Stripe Configuration
```typescript
// apps/portal/src/config/stripe.ts
export const STRIPE_CONFIG = {
  publishableKey: import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY,
  prices: {
    proMonthly: import.meta.env.VITE_STRIPE_PRICE_PRO_MONTHLY,
    proYearly: import.meta.env.VITE_STRIPE_PRICE_PRO_YEARLY,
  },
};
```

### 3. Create Checkout Hook
```typescript
// apps/portal/src/hooks/useStripeCheckout.ts
export function useStripeCheckout() {
  const redirectToCheckout = async (priceId: string) => {
    const stripe = await loadStripe(STRIPE_CONFIG.publishableKey);

    const { error } = await stripe.redirectToCheckout({
      mode: 'subscription',
      lineItems: [{ price: priceId, quantity: 1 }],
      successUrl: `${window.location.origin}/checkout/success`,
      cancelUrl: `${window.location.origin}/checkout/cancel`,
    });

    if (error) {
      console.error('Stripe checkout error:', error);
    }
  };

  return { redirectToCheckout };
}
```

### 4. Create PricingPage Component
```typescript
// apps/portal/src/pages/Pricing.tsx
- Free tier: $0/month, individual use only
- Pro monthly: $X/month, unlimited collaborators
- Pro yearly: $Y/year (2 months free)
- Checkout buttons for each tier
- Feature comparison table
```

### 5. Create Checkout Callback Pages
```typescript
// apps/portal/src/pages/CheckoutSuccess.tsx
// apps/portal/src/pages/CheckoutCancel.tsx
```

## Files to Create
- `apps/portal/src/config/stripe.ts`
- `apps/portal/src/hooks/useStripeCheckout.ts`
- `apps/portal/src/pages/Pricing.tsx`
- `apps/portal/src/pages/CheckoutSuccess.tsx`
- `apps/portal/src/pages/CheckoutCancel.tsx`

## Files to Modify
- `apps/portal/src/components/UpgradePrompt.tsx` - Add checkout button
- `apps/portal/src/App.tsx` - Add pricing routes

## Environment Variables Required
```
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_...
VITE_STRIPE_PRICE_PRO_MONTHLY=price_...
VITE_STRIPE_PRICE_PRO_YEARLY=price_...
```

## Notes
- Use Stripe Checkout (not Elements) for simplicity
- Redirect-based flow, not embedded
- Success/cancel pages show appropriate messages
- Backend creates Stripe customer and checkout session (next step)
