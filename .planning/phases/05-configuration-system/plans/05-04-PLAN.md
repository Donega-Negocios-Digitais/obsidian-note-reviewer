---
phase: 05-configuration-system
plan: 04
type: execute
wave: 3
depends_on: [08-02]
files_modified: [packages/ui/components/SettingsPanel.tsx, packages/ui/utils/identity.ts]
autonomous: true

must_haves:
  truths:
    - "Identity category has form fields for personalization (name, avatar, bio, signature)"
    - "Keyboard shortcuts show current assignments with clear labels"
    - "Can reassign shortcuts by clicking and pressing new key"
    - "Custom shortcuts can be added"
    - "Reset button restores default shortcuts"
    - "All changes persist to localStorage"
  artifacts:
    - path: "packages/ui/components/SettingsPanel.tsx"
      provides: "Redesigned identity and shortcuts settings"
      contains: "identidade tab with personalization fields, atalhos tab with shortcut editor"
    - path: "packages/ui/utils/shortcuts.ts"
      provides: "Keyboard shortcuts management utilities"
      contains: "resetShortcuts, updateShortcut"
  key_links:
    - from: "identidade tab form inputs"
      to: "localStorage"
      via: "updateDisplayName, regenerateIdentity"
      pattern: "updateDisplayName|regenerateIdentity"
    - from: "atalhos tab"
      to: "shortcuts utility"
      via: "resetShortcuts, updateShortcut"
      pattern: "resetShortcuts|updateShortcut"
---

<objective>
Redesign the personalization (Identidade do Revisor) and productivity (Atalhos de Teclado) settings categories with improved UX and enhanced functionality.

Purpose: Improve the identity management with additional personalization fields and enhance keyboard shortcuts with interactive editing, custom shortcuts, and reset functionality.

Output: Redesigned identidade and atalhos categories with enhanced features and Apple-style design.
</objective>

<execution_context>
@C:\Users\Alex\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Alex\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-configuration-system/08-RESEARCH.md

@.planning/phases/05-configuration-system/plans/05-02-SUMMARY.md
@packages/ui/components/SettingsPanel.tsx
@packages/ui/utils/identity.ts
@packages/ui/utils/shortcuts.ts
</context>

<tasks>

<task type="auto">
  <name>Redesign identity category with additional personalization fields</name>
  <files>packages/ui/components/SettingsPanel.tsx</files>
  <action>
Enhance the 'identidade' category (currently around lines 397-449) with more personalization options:

1. Redesign with Apple-style card layout:
```tsx
{activeTab === 'identidade' ? (
  <div className="p-5 space-y-5 overflow-y-auto">
    {/* Profile Section */}
    <div className="bg-card/50 rounded-xl border border-border/50 p-5">
      <div className="flex items-center gap-3 mb-4">
        <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-xl">
          üë§
        </div>
        <div>
          <h4 className="text-sm font-semibold text-foreground">Perfil do Revisor</h4>
          <p className="text-xs text-muted-foreground">Personalize sua identidade nas anota√ß√µes</p>
        </div>
      </div>

      {/* Display Name */}
      <div className="space-y-3">
        <label className="text-xs font-medium text-muted-foreground">
          Nome de Exibi√ß√£o
        </label>
        <input
          type="text"
          value={displayName}
          onChange={(e) => handleDisplayNameChange(e.target.value)}
          placeholder="Ex: Jo√£o Silva"
          className="w-full px-3 py-2.5 bg-background rounded-lg text-sm border border-border focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none transition-all"
        />
        <p className="text-[11px] text-muted-foreground/70">
          Este nome ser√° exibido em suas anota√ß√µes. Deixe em branco para usar identidade an√¥nima.
        </p>
      </div>
    </div>

    {/* Current Identity Section */}
    <div className="bg-card/50 rounded-xl border border-border/50 p-5">
      <div className="flex items-center gap-3 mb-4">
        <div className="w-10 h-10 rounded-lg bg-muted/50 flex items-center justify-center text-xl">
          ü™™
        </div>
        <div>
          <h4 className="text-sm font-semibold text-foreground">Identidade Ativa</h4>
          <p className="text-xs text-muted-foreground">Usada para identificar suas anota√ß√µes</p>
        </div>
      </div>

      <div className="space-y-3">
        <div>
          <label className="text-xs font-medium text-muted-foreground block mb-1.5">
            Identidade Principal
          </label>
          <div className="px-3 py-2 bg-muted rounded-lg text-xs font-mono text-muted-foreground break-all">
            {identity}
          </div>
        </div>

        {displayName.trim() && (
          <div>
            <label className="text-xs font-medium text-muted-foreground/60 block mb-1.5">
              Backup An√¥nimo
            </label>
            <div className="px-3 py-2 bg-muted/50 rounded-lg text-[11px] font-mono text-muted-foreground/50 break-all">
              {anonymousIdentity}
            </div>
            <p className="text-[10px] text-muted-foreground/50 mt-1">
              Salvo caso voc√™ remova o nome de exibi√ß√£o
            </p>
          </div>
        )}
      </div>
    </div>

    {/* Actions Section */}
    <div className="bg-card/50 rounded-xl border border-border/50 p-5">
      <button
        onClick={handleRegenerateIdentity}
        className="w-full px-4 py-2.5 text-sm font-medium text-primary bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors flex items-center justify-center gap-2"
      >
        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        Gerar Nova Identidade
      </button>
      <p className="text-[11px] text-muted-foreground/60 text-center mt-2">
        Isso criar√° uma nova identidade an√¥nima para suas anota√ß√µes
      </p>
    </div>
  </div>
) : ...}
```

2. Optional: Add avatar selector (if time permits):
```tsx
{/* Avatar Selection - Optional Enhancement */}
<div className="space-y-3">
  <label className="text-xs font-medium text-muted-foreground">Avatar</label>
  <div className="flex gap-2 flex-wrap">
    {['üë§', 'üë®‚Äçüíª', 'üë©‚Äçüíª', 'üßë‚Äçüé®', 'üë®‚Äçüè´', 'üë©‚Äçüè´'].map(avatar => (
      <button
        key={avatar}
        onClick={() => handleAvatarChange(avatar)}
        className={`
          w-10 h-10 rounded-lg text-2xl flex items-center justify-center transition-all
          ${selectedAvatar === avatar
            ? 'bg-primary/20 border-2 border-primary'
            : 'bg-muted/50 hover:bg-muted border-2 border-transparent'
          }
        `}
      >
        {avatar}
      </button>
    ))}
  </div>
</div>
```

Keep all existing functionality (displayName, identity, anonymousIdentity, regenerateIdentity).
  </action>
  <verify>identidade tab has redesigned card layout with Profile, Current Identity, and Actions sections</verify>
  <done>Identity category redesigned with improved visual hierarchy and clearer sections</done>
</task>

<task type="auto">
  <name>Enhance keyboard shortcuts with interactive editing</name>
  <files>packages/ui/components/SettingsPanel.tsx, packages/ui/utils/shortcuts.ts</files>
  <action>
Enhance the 'atalhos' category (currently around lines 450-479) with interactive editing:

1. First, check if packages/ui/utils/shortcuts.ts exists and read it
2. If it doesn't have reset/update functions, add them:
```tsx
// In shortcuts.ts, add:
export function resetShortcuts() {
  localStorage.removeItem('obsreview-shortcuts');
  // Will reload defaults on next mount
}

export function updateShortcut(category: string, shortcutId: string, newKey: string) {
  const shortcuts = getAllShortcuts(); // existing function
  const categoryShortcuts = shortcuts[category];
  const shortcut = categoryShortcuts.find(s => s.id === shortcutId);
  if (shortcut) {
    shortcut.key = newKey;
    localStorage.setItem('obsreview-shortcuts', JSON.stringify(shortcuts));
  }
}
```

3. Redesign atalhos tab with interactive editing:
```tsx
{activeTab === 'atalhos' ? (
  <div className="p-5 space-y-4 overflow-y-auto">
    {/* Header */}
    <div className="flex items-center justify-between">
      <div>
        <h4 className="text-sm font-semibold text-foreground">Atalhos de Teclado</h4>
        <p className="text-xs text-muted-foreground">Clique para redefinir</p>
      </div>
      <button
        onClick={() => {
          resetShortcuts();
          window.location.reload(); // Reload to refresh shortcuts
        }}
        className="px-3 py-1.5 text-xs font-medium text-muted-foreground hover:text-foreground bg-muted/50 hover:bg-muted rounded-lg transition-colors"
      >
        Restaurar Padr√µes
      </button>
    </div>

    {/* Shortcuts by category */}
    {CATEGORY_ORDER.filter(category => {
      const shortcuts = getShortcutsByCategory()[category];
      return shortcuts && shortcuts.length > 0;
    }).map(category => (
      <div key={category} className="bg-card/50 rounded-xl border border-border/50 p-4">
        <h5 className="text-xs font-medium text-muted-foreground uppercase tracking-wider mb-3">
          {CATEGORY_LABELS[category]}
        </h5>
        <div className="space-y-1.5">
          {getShortcutsByCategory()[category].map(shortcut => (
            <div
              key={shortcut.id}
              className="flex items-center justify-between py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors group cursor-pointer"
              onClick={() => {
                // Trigger reassign flow
                const newKey = prompt(`Pressione a nova tecla para "${shortcut.label}"`, shortcut.key);
                if (newKey && newKey !== shortcut.key) {
                  updateShortcut(category, shortcut.id, newKey);
                  window.location.reload();
                }
              }}
            >
              <span className="text-xs font-medium text-foreground">
                {shortcut.label}
              </span>
              <kbd className="ml-2 px-2 py-1 text-[10px] font-mono bg-muted border border-border rounded text-muted-foreground group-hover:border-primary/50 transition-colors">
                {formatShortcutKey(shortcut)}
              </kbd>
            </div>
          ))}
        </div>
      </div>
    ))}

    {/* Info tip */}
    <div className="p-3 rounded-lg bg-muted/30 text-center">
      <p className="text-xs text-muted-foreground">
        üí° Clique em qualquer atalho para redefinir a tecla
      </p>
    </div>
  </div>
) : ...}
```

4. The click-to-reassign flow:
   - User clicks a shortcut row
   - Prompt appears to enter new key
   - updateShortcut saves to localStorage
   - Page reloads to refresh shortcuts

This is a simple implementation - a more sophisticated version would use a modal with key capture, but the prompt approach works for now.
  </action>
  <verify>atalhos tab has redesigned layout with interactive shortcut rows, restore defaults button, and click-to-reassign functionality</verify>
  <done>Keyboard shortcuts category enhanced with interactive editing and reset functionality</done>
</task>

</tasks>

<verification>
After completion, verify:
1. Identity category has 3 card sections: Profile, Current Identity, Actions
2. Display name field saves properly
3. Identity display shows current and backup identities
4. Regenerate button creates new identity
5. Shortcuts display by category with clear labels
6. Clicking a shortcut allows reassigning the key
7. Restore defaults button resets all shortcuts
8. All changes persist across page refresh
</verification>

<success_criteria>
1. Identity category redesigned with Apple-style cards
2. Keyboard shortcuts have interactive editing
3. Reset to defaults functionality works
4. All changes persist to localStorage
5. Visual design matches other categories
</success_criteria>

<output>
After completion, create `.planning/phases/05-configuration-system/plans/05-04-SUMMARY.md` with:
- Identity category redesign details
- Keyboard shortcuts enhancement implementation
- Any utility functions added
- User experience improvements
</output>
