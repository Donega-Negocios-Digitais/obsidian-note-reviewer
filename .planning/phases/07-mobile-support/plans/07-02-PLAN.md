---
phase: 07-mobile-support
plan: 02
type: execute
wave: 1
depends_on: ["07-01"]
files_modified:
  - apps/portal/src/components/BreakpointPreview.tsx
  - apps/portal/src/hooks/useBreakpointPreview.ts
  - apps/portal/src/components/DocumentWorkspace.tsx
autonomous: false

must_haves:
  truths:
    - "User can preview content at different breakpoints"
    - "Side-by-side comparison of mobile/tablet/desktop views"
    - "Toggle between preview modes (single/split/all)"
    - "Preview shows accurate rendering at each breakpoint"
  artifacts:
    - path: "apps/portal/src/hooks/useBreakpointPreview.ts"
      provides: "Breakpoint preview state management"
      exports: ["useBreakpointPreview"]
      min_lines: 80
    - path: "apps/portal/src/components/BreakpointPreview.tsx"
      provides: "Breakpoint comparison UI component"
      exports: ["BreakpointPreview", "BreakpointFrame", "BreakpointToggle"]
      min_lines: 200

<objective>
Build breakpoint comparison tool for viewing content across different device sizes simultaneously.

**Purpose:** Deliver MOBL-02 requirement - compare views across mobile/tablet/desktop breakpoints.

**Output:** Complete breakpoint preview tool with side-by-side comparison.
</objective>

<tasks>

<task type="auto">
  <name>Create useBreakpointPreview hook</name>
  <files>apps/portal/src/hooks/useBreakpointPreview.ts</files>
  <action>
    Create `apps/portal/src/hooks/useBreakpointPreview.ts`:

    ```typescript
    /**
     * Breakpoint Preview Hook
     *
     * Manages breakpoint preview state for comparison tool.
     */

    import { useState, useCallback, useMemo } from 'react';

    export type PreviewMode = 'single' | 'split' | 'all';
    export type ActiveBreakpoint = 'mobile' | 'tablet' | 'desktop' | 'all';

    export interface BreakpointSize {
      name: 'mobile' | 'tablet' | 'desktop';
      label: string;
      width: number;
      height: number;
      icon: string;
    }

    export interface BreakpointPreviewOptions {
      defaultMode?: PreviewMode;
      defaultBreakpoint?: ActiveBreakpoint;
    }

    export interface UseBreakpointPreviewReturn {
      mode: PreviewMode;
      setMode: (mode: PreviewMode) => void;
      activeBreakpoint: ActiveBreakpoint;
      setActiveBreakpoint: (breakpoint: ActiveBreakpoint) => void;
      visibleBreakpoints: BreakpointSize[];
      toggleMode: () => void;
      cycleBreakpoint: () => void;
      isPreviewActive: boolean;
      activatePreview: () => void;
      deactivatePreview: () => void;
    }

    const BREAKPOINTS: Record<'mobile' | 'tablet' | 'desktop', Omit<BreakpointSize, 'name'>> = {
      mobile: {
        label: 'Mobile',
        width: 375,
        height: 667,
        icon: 'üì±',
      },
      tablet: {
        label: 'Tablet',
        width: 768,
        height: 1024,
        icon: 'üì±',
      },
      desktop: {
        label: 'Desktop',
        width: 1440,
        height: 900,
        icon: 'üñ•Ô∏è',
      },
    };

    const BREAKPOINT_LIST: BreakpointSize[] = [
      { name: 'mobile', ...BREAKPOINTS.mobile },
      { name: 'tablet', ...BREAKPOINTS.tablet },
      { name: 'desktop', ...BREAKPOINTS.desktop },
    ];

    /**
     * Hook for managing breakpoint preview state
     */
    export function useBreakpointPreview(
      options: BreakpointPreviewOptions = {}
    ): UseBreakpointPreviewReturn {
      const {
        defaultMode = 'single',
        defaultBreakpoint = 'desktop',
      } = options;

      const [mode, setMode] = useState<PreviewMode>(defaultMode);
      const [activeBreakpoint, setActiveBreakpoint] = useState<ActiveBreakpoint>(defaultBreakpoint);
      const [isPreviewActive, setIsPreviewActive] = useState(false);

      /**
       * Get list of visible breakpoints based on mode
       */
      const visibleBreakpoints = useMemo((): BreakpointSize[] => {
        switch (mode) {
          case 'single':
            return BREAKPOINT_LIST.filter((bp) => bp.name === activeBreakpoint);
          case 'split':
            return BREAKPOINT_LIST.filter((bp) =>
              activeBreakpoint === 'all'
                ? bp.name === 'mobile' || bp.name === 'desktop'
                : bp.name === activeBreakpoint || bp.name === 'desktop'
            );
          case 'all':
            return BREAKPOINT_LIST;
          default:
            return BREAKPOINT_LIST;
        }
      }, [mode, activeBreakpoint]);

      /**
       * Toggle between preview modes
       */
      const toggleMode = useCallback(() => {
        setMode((prev) => {
          switch (prev) {
            case 'single':
              return 'split';
            case 'split':
              return 'all';
            case 'all':
              return 'single';
            default:
              return 'single';
          }
        });
      }, []);

      /**
       * Cycle through breakpoints
       */
      const cycleBreakpoint = useCallback(() => {
        setActiveBreakpoint((prev) => {
          switch (prev) {
            case 'mobile':
              return 'tablet';
            case 'tablet':
              return 'desktop';
            case 'desktop':
              return 'mobile';
            case 'all':
              return 'mobile';
            default:
              return 'desktop';
          }
        });
      }, []);

      const activatePreview = useCallback(() => setIsPreviewActive(true), []);
      const deactivatePreview = useCallback(() => setIsPreviewActive(false), []);

      return {
        mode,
        setMode,
        activeBreakpoint,
        setActiveBreakpoint,
        visibleBreakpoints,
        toggleMode,
        cycleBreakpoint,
        isPreviewActive,
        activatePreview,
        deactivatePreview,
      };
    }

    export { BREAKPOINTS, BREAKPOINT_LIST };
    export default useBreakpointPreview;
    ```

    Save to `apps/portal/src/hooks/useBreakpointPreview.ts`.
  </action>
  <verify>useBreakpointPreview hook created</verify>
  <done>Breakpoint preview hook</done>
</task>

<task type="auto">
  <name>Create BreakpointPreview component</name>
  <files>apps/portal/src/components/BreakpointPreview.tsx</files>
  <action>
    Create `apps/portal/src/components/BreakpointPreview.tsx`:

    ```typescript
    /**
     * Breakpoint Preview Component
     *
     * Preview content at different breakpoints for comparison.
     */

    import React from 'react';
      { useBreakpointPreview, type BreakpointSize, type PreviewMode } from '../hooks/useBreakpointPreview';

    export interface BreakpointPreviewProps {
      children: React.ReactNode;
    }

    /**
     * Breakpoint preview container with toolbar
     */
    export function BreakpointPreview({ children }: BreakpointPreviewProps) {
      const {
        mode,
        setMode,
        activeBreakpoint,
        setActiveBreakpoint,
        visibleBreakpoints,
        toggleMode,
        cycleBreakpoint,
        isPreviewActive,
        activatePreview,
        deactivatePreview,
      } = useBreakpointPreview();

      if (!isPreviewActive) {
        return (
          <>
            {children}
            <PreviewToggleButton onClick={activatePreview} />
          </>
        );
      }

      return (
        <div className="breakpoint-preview fixed inset-0 z-50 bg-gray-100 dark:bg-gray-900">
          {/* Toolbar */}
          <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-white">
                  Breakpoint Preview
                </h2>

                {/* Mode Toggle */}
                <div className="flex items-center gap-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                  <ModeButton
                    mode="single"
                    current={mode}
                    onClick={() => setMode('single')}
                    label="Single"
                  />
                  <ModeButton
                    mode="split"
                    current={mode}
                    onClick={() => setMode('split')}
                    label="Split"
                  />
                  <ModeButton
                    mode="all"
                    current={mode}
                    onClick={() => setMode('all')}
                    label="All"
                  />
                </div>

                {/* Breakpoint Selector */}
                <div className="flex items-center gap-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                  <BreakpointButton
                    bp="mobile"
                    current={activeBreakpoint}
                    onClick={() => setActiveBreakpoint('mobile')}
                    label="üì± Mobile"
                  />
                  <BreakpointButton
                    bp="tablet"
                    current={activeBreakpoint}
                    onClick={() => setActiveBreakpoint('tablet')}
                    label="üì± Tablet"
                  />
                  <BreakpointButton
                    bp="desktop"
                    current={activeBreakpoint}
                    onClick={() => setActiveBreakpoint('desktop')}
                    label="üñ•Ô∏è Desktop"
                  />
                </div>
              </div>

              <div className="flex items-center gap-2">
                <button
                  onClick={cycleBreakpoint}
                  className="px-3 py-1.5 text-sm text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors"
                  title="Cycle breakpoints"
                >
                  Cycle
                </button>
                <button
                  onClick={deactivatePreview}
                  className="px-3 py-1.5 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"
                >
                  Close
                </button>
              </div>
            </div>
          </div>

          {/* Preview Frames */}
          <div className="flex-1 p-6 overflow-auto">
            <div className={`
              flex gap-6 items-start justify-center h-full
              ${visibleBreakpoints.length > 1 ? 'flex-wrap' : ''}
            `}>
              {visibleBreakpoints.map((bp) => (
                <BreakpointFrame
                  key={bp.name}
                  breakpoint={bp}
                  showLabel={mode === 'all'}
                >
                  {children}
                </BreakpointFrame>
              ))}
            </div>
          </div>
        </div>
      );
    }

    interface ModeButtonProps {
      mode: PreviewMode;
      current: PreviewMode;
      onClick: () => void;
      label: string;
    }

    function ModeButton({ mode, current, onClick, label }: ModeButtonProps) {
      return (
        <button
          onClick={onClick}
          className={`
            px-3 py-1.5 text-xs font-medium rounded-md transition-colors
            ${current === mode
              ? 'bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm'
              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'
            }
          `}
        >
          {label}
        </button>
      );
    }

    interface BreakpointButtonProps {
      bp: 'mobile' | 'tablet' | 'desktop' | 'all';
      current: string;
      onClick: () => void;
      label: string;
    }

    function BreakpointButton({ bp, current, onClick, label }: BreakpointButtonProps) {
      return (
        <button
          onClick={onClick}
          className={`
            px-3 py-1.5 text-xs font-medium rounded-md transition-colors
            ${current === bp
              ? 'bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm'
              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'
            }
          `}
        >
          {label}
        </button>
      );
    }

    /**
     * Individual breakpoint frame
     */
    export interface BreakpointFrameProps {
      breakpoint: BreakpointSize;
      showLabel?: boolean;
      children: React.ReactNode;
    }

    export function BreakpointFrame({ breakpoint, showLabel, children }: BreakpointFrameProps) {
      return (
        <div className="flex flex-col items-center">
          {showLabel && (
            <div className="mb-2 px-3 py-1 bg-white dark:bg-gray-800 rounded-full text-xs font-medium text-gray-700 dark:text-gray-300 shadow-sm">
              {breakpoint.icon} {breakpoint.label} ({breakpoint.width}√ó{breakpoint.height})
            </div>
          )}
          <div
            className="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-auto border border-gray-200 dark:border-gray-700"
            style={{
              width: breakpoint.width,
              height: breakpoint.height,
              maxWidth: '100%',
            }}
          >
            <div className="w-full h-full">
              {children}
            </div>
          </div>
        </div>
      );
    }

    /**
     * Toggle button for activating preview
     */
    interface PreviewToggleButtonProps {
      onClick: () => void;
    }

    function PreviewToggleButton({ onClick }: PreviewToggleButtonProps) {
      return (
        <button
          onClick={onClick}
          className="fixed bottom-6 right-6 z-40 flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-full shadow-lg transition-colors"
          title="Open breakpoint preview"
        >
          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          <span className="text-sm font-medium">Preview</span>
        </button>
      );
    }

    export default BreakpointPreview;
    ```

    Save to `apps/portal/src/components/BreakpointPreview.tsx`.
  </action>
  <verify>BreakpointPreview component created</verify>
  <done>Breakpoint preview component</done>
</task>

<task type="auto">
  <name>Integrate BreakpointPreview into DocumentWorkspace</name>
  <files>apps/portal/src/components/DocumentWorkspace.tsx</files>
  <action>
    Update `apps/portal/src/components/DocumentWorkspace.tsx` to integrate breakpoint preview:

    1. Import the component:
    ```typescript
    import { BreakpointPreview } from './BreakpointPreview';
    ```

    2. Wrap the workspace content with BreakpointPreview:
    ```typescript
    return (
      <div className={`document-workspace flex flex-col h-full ${className}`}>
        <BreakpointPreview>
          {/* Tab Bar */}
          <TabsComponent ... />

          {/* Content Area */}
          <div className="flex-1 overflow-auto">...</div>
        </BreakpointPreview>
      </div>
    );
    ```

    This adds the floating preview button and full-screen preview mode.
  </action>
  <verify>BreakpointPreview integrated</verify>
  <done>Integrated breakpoint preview</done>
</task>

</tasks>

<verification>
- [ ] useBreakpointPreview manages preview state
- [ ] BreakpointPreview shows toolbar with mode toggle
- [ ] Single mode shows one breakpoint at a time
- [ ] Split mode shows mobile + desktop
- [ ] All mode shows all three breakpoints
- [ ] BreakpointFrame renders at correct dimensions
- [ ] Preview toggle button floats in corner
- [ ] Close button exits preview mode
</verification>

<success_criteria>
1. User can compare views across breakpoints (MOBL-02)
2. Side-by-side comparison available
3. Toggle between single/split/all modes
4. Accurate rendering at each breakpoint
</success_criteria>

---

**Plan created:** 2026-02-06
**Estimated duration:** 20 min
**Complexity:** Medium (preview state, iframes/sizing, responsive UI)
