---
phase: 07-mobile-support
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/portal/src/components/MobileLayout.tsx
  - apps/portal/src/components/DocumentWorkspace.tsx
  - apps/portal/src/components/DocumentTabs.tsx
  - apps/portal/src/hooks/useResponsive.ts
  - apps/portal/src/hooks/useBreakpoint.ts
autonomous: false

must_haves:
  truths:
    - "Interface adapts to mobile screen sizes (< 640px)"
    - "Interface adapts to tablet screen sizes (640px - 1024px)"
    - "Interface adapts to desktop screen sizes (> 1024px)"
    - "Touch interactions work properly on mobile devices"
    - "Responsive breakpoints are consistent across components"
  artifacts:
    - path: "apps/portal/src/hooks/useResponsive.ts"
      provides: "Responsive breakpoint detection hook"
      exports: ["useResponsive"]
      min_lines: 50
    - path: "apps/portal/src/hooks/useBreakpoint.ts"
      provides: "Breakpoint comparison utilities"
      exports: ["useBreakpoint", "useMediaQuery"]
      min_lines: 40
    - path: "apps/portal/src/components/MobileLayout.tsx"
      provides: "Mobile-optimized layout component"
      exports: ["MobileLayout", "MobileHeader", "MobileNav"]
      min_lines: 150

<objective>
Implement responsive design for mobile devices so the interface works seamlessly across different screen sizes.

**Purpose:** Deliver MOBL-01 requirement - interface functions correctly on mobile devices with touch interactions.

**Output:** Complete responsive design system with mobile-optimized components.
</objective>

<tasks>

<task type="auto">
  <name>Create useResponsive hook</name>
  <files>apps/portal/src/hooks/useResponsive.ts</files>
  <action>
    Create `apps/portal/src/hooks/useResponsive.ts`:

    ```typescript
    /**
     * Responsive Hook
     *
     * Provides responsive breakpoint detection for React components.
     */

    import { useState, useEffect } from 'react';

    export type Breakpoint = 'mobile' | 'tablet' | 'desktop';

    export interface ResponsiveValues {
      isMobile: boolean;
      isTablet: boolean;
      isDesktop: boolean;
      breakpoint: Breakpoint;
      width: number;
      height: number;
    }

    export interface ResponsiveOptions {
      mobileBreakpoint?: number;
      tabletBreakpoint?: number;
    }

    const DEFAULT_BREAKPOINTS = {
      mobile: 640,
      tablet: 1024,
    };

    /**
     * Get current breakpoint from window width
     */
    function getBreakpoint(width: number, options: ResponsiveOptions): Breakpoint {
      const mobileBreakpoint = options.mobileBreakpoint ?? DEFAULT_BREAKPOINTS.mobile;
      const tabletBreakpoint = options.tabletBreakpoint ?? DEFAULT_BREAKPOINTS.tablet;

      if (width < mobileBreakpoint) return 'mobile';
      if (width < tabletBreakpoint) return 'tablet';
      return 'desktop';
    }

    /**
     * Hook for responsive breakpoint detection
     *
     * Updates on window resize and provides convenient breakpoint checks.
     */
    export function useResponsive(options: ResponsiveOptions = {}): ResponsiveValues {
      const [dimensions, setDimensions] = useState(() => {
        if (typeof window === 'undefined') {
          return { width: 1024, height: 768 };
        }
        return {
          width: window.innerWidth,
          height: window.innerHeight,
        };
      });

      const [breakpoint, setBreakpoint] = useState<Breakpoint>(() =>
        getBreakpoint(dimensions.width, options)
      );

      useEffect(() => {
        if (typeof window === 'undefined') return;

        const handleResize = () => {
          const newWidth = window.innerWidth;
          const newHeight = window.innerHeight;

          setDimensions({ width: newWidth, height: newHeight });
          setBreakpoint(getBreakpoint(newWidth, options));
        };

        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, [options.mobileBreakpoint, options.tabletBreakpoint]);

      return {
        isMobile: breakpoint === 'mobile',
        isTablet: breakpoint === 'tablet',
        isDesktop: breakpoint === 'desktop',
        breakpoint,
        width: dimensions.width,
        height: dimensions.height,
      };
    }

    /**
     * Hook for checking if a specific media query matches
     */
    export function useMediaQuery(query: string): boolean {
      const [matches, setMatches] = useState(() => {
        if (typeof window === 'undefined') return false;
        return window.matchMedia(query).matches;
      });

      useEffect(() => {
        if (typeof window === 'undefined') return;

        const mediaQuery = window.matchMedia(query);
        const handler = (e: MediaQueryListEvent) => setMatches(e.matches);

        mediaQuery.addEventListener('change', handler);
        return () => mediaQuery.removeEventListener('change', handler);
      }, [query]);

      return matches;
    }

    export default useResponsive;
    ```

    Save to `apps/portal/src/hooks/useResponsive.ts`.
  </action>
  <verify>useResponsive hook created with breakpoint detection</verify>
  <done>Responsive hook</done>
</task>

<task type="auto">
  <name>Create useBreakpoint utility hook</name>
  <files>apps/portal/src/hooks/useBreakpoint.ts</files>
  <action>
    Create `apps/portal/src/hooks/useBreakpoint.ts`:

    ```typescript
    /**
     * Breakpoint Utility Hook
     *
     * Utilities for breakpoint-based rendering.
     */

    import { useResponsive } from './useResponsive';

    export type BreakpointValue<T> = T | {
      mobile?: T;
      tablet?: T;
      desktop?: T;
    };

    /**
     * Get value based on current breakpoint
     */
    function getValueForBreakpoint<T>(
      values: BreakpointValue<T>,
      breakpoint: 'mobile' | 'tablet' | 'desktop'
    ): T {
      if (typeof values === 'object' && values !== null && !Array.isArray(values)) {
        // It's a breakpoint object
        return values[breakpoint] ?? values.desktop ?? values.tablet ?? values.mobile ?? (values as any);
      }
      // It's a single value
      return values;
    }

    /**
     * Hook for responsive values
     *
     * Pass different values for different breakpoints.
     */
    export function useBreakpoint<T>(values: BreakpointValue<T>): T {
      const { breakpoint } = useResponsive();
      return getValueForBreakpoint(values, breakpoint);
    }

    /**
     * Hook for conditional rendering based on breakpoint
     */
    export function useBreakpointHide(options: {
      hideOnMobile?: boolean;
      hideOnTablet?: boolean;
      hideOnDesktop?: boolean;
    }): boolean {
      const { isMobile, isTablet, isDesktop } = useResponsive();

      if (options.hideOnMobile && isMobile) return true;
      if (options.hideOnTablet && isTablet) return true;
      if (options.hideOnDesktop && isDesktop) return true;

      return false;
    }

    /**
     * Hook for showing only on specific breakpoints
     */
    export function useBreakpointShow(options: {
      showOnMobile?: boolean;
      showOnTablet?: boolean;
      showOnDesktop?: boolean;
    }): boolean {
      const { isMobile, isTablet, isDesktop } = useResponsive();

      if (options.showOnMobile && isMobile) return true;
      if (options.showOnTablet && isTablet) return true;
      if (options.showOnDesktop && isDesktop) return true;

      return false;
    }

    export default useBreakpoint;
    ```

    Save to `apps/portal/src/hooks/useBreakpoint.ts`.
  </action>
  <verify>useBreakpoint hook created with utilities</verify>
  <done>Breakpoint utilities</done>
</task>

<task type="auto">
  <name>Create MobileLayout component</name>
  <files>apps/portal/src/components/MobileLayout.tsx</files>
  <action>
    Create `apps/portal/src/components/MobileLayout.tsx`:

    ```typescript
    /**
     * Mobile Layout Component
     *
     * Mobile-optimized layout with responsive behavior.
     */

    import React, { useState } from 'react';
    import { useResponsive, type Breakpoint } from '../hooks/useResponsive';

    export interface MobileLayoutProps {
      children: React.ReactNode;
      header?: React.ReactNode;
      sidebar?: React.ReactNode;
      className?: string;
    }

    /**
     * Responsive layout wrapper
     */
    export function MobileLayout({
      children,
      header,
      sidebar,
      className = '',
    }: MobileLayoutProps) {
      const { isMobile } = useResponsive();

      return (
        <div className={`mobile-layout flex flex-col h-full ${className}`}>
          {header && (
            <div className="flex-shrink-0">
              {header}
            </div>
          )}
          <div className={`flex flex-1 overflow-hidden ${isMobile ? 'flex-col' : 'flex-row'}`}>
            {sidebar && (
              <aside className={`
                ${isMobile
                  ? 'w-full border-b border-gray-200 dark:border-gray-700 overflow-y-auto'
                  : 'w-64 border-r border-gray-200 dark:border-gray-700 overflow-y-auto'
                }
              `}>
                {sidebar}
              </aside>
            )}
            <main className="flex-1 overflow-auto">
              {children}
            </main>
          </div>
        </div>
      );
    }

    /**
     * Mobile-optimized header with hamburger menu
     */
    export interface MobileHeaderProps {
      title: string;
      onMenuToggle?: () => void;
      menuOpen?: boolean;
      actions?: React.ReactNode;
    }

    export function MobileHeader({
      title,
      onMenuToggle,
      menuOpen,
      actions,
    }: MobileHeaderProps) {
      return (
        <header className="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              {onMenuToggle && (
                <button
                  onClick={onMenuToggle}
                  className="p-2 -ml-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg transition-colors"
                  aria-label="Toggle menu"
                >
                  {menuOpen ? (
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  ) : (
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                  )}
                </button>
              )}
              <h1 className="text-lg font-semibold text-gray-900 dark:text-white truncate">
                {title}
              </h1>
            </div>
            {actions && (
              <div className="flex items-center gap-2">
                {actions}
              </div>
            )}
          </div>
        </header>
      );
    }

    /**
     * Mobile bottom navigation bar
     */
    export interface MobileNavProps {
      children: React.ReactNode;
      className?: string;
    }

    export function MobileNav({ children, className = '' }: MobileNavProps) {
      const { isMobile } = useResponsive();

      if (!isMobile) return null;

      return (
        <nav className={`
          flex-shrink-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700
          ${className}
        `}>
          <div className="flex items-center justify-around py-2">
            {children}
          </div>
        </nav>
      );
    }

    /**
     * Mobile navigation item
     */
    export interface MobileNavItemProps {
      icon: React.ReactNode;
      label: string;
      active?: boolean;
      onClick?: () => void;
    }

    export function MobileNavItem({ icon, label, active, onClick }: MobileNavItemProps) {
      return (
        <button
          onClick={onClick}
          className={`
            flex flex-col items-center gap-1 px-4 py-2 rounded-lg transition-colors min-w-0
            ${active
              ? 'text-blue-600 dark:text-blue-400'
              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'
            }
          `}
        >
          <span className="text-xl">{icon}</span>
          <span className="text-xs font-medium truncate">{label}</span>
        </button>
      );
    }

    /**
     * Responsive container that changes padding based on breakpoint
     */
    export interface ResponsiveContainerProps {
      children: React.ReactNode;
      mobile?: React.ReactNode;
      className?: string;
    }

    export function ResponsiveContainer({
      children,
      mobile,
      className = '',
    }: ResponsiveContainerProps) {
      const { isMobile } = useResponsive();

      return (
        <div className={`responsive-container ${isMobile ? 'px-4 py-3' : 'px-6 py-4'} ${className}`}>
          {isMobile && mobile ? mobile : children}
        </div>
      );
    }

    export default MobileLayout;
    ```

    Save to `apps/portal/src/components/MobileLayout.tsx`.
  </action>
  <verify>MobileLayout component created</verify>
  <done>Mobile layout component</done>
</task>

<task type="auto">
  <name>Update DocumentTabs for mobile</name>
  <files>apps/portal/src/components/DocumentTabs.tsx</files>
  <action>
    Update `apps/portal/src/components/DocumentTabs.tsx` for mobile responsiveness:

    1. Import useResponsive hook:
    ```typescript
    import { useResponsive } from '../hooks/useResponsive';
    ```

    2. Add responsive behavior to the tab bar:
    - On mobile: Horizontal scrollable tabs with full-width touch targets
    - On tablet/desktop: Existing behavior

    3. Modify the main container class to handle mobile:
    ```typescript
    const { isMobile } = useResponsive();

    // In the main div className:
    className={`document-tabs flex items-center gap-1 ${isMobile ? 'px-1 py-1 overflow-x-auto snap-x' : 'px-2 py-1'} bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700`}
    ```

    4. Update Tab component for mobile touch targets:
    ```typescript
    // In Tab className, add:
    ${isMobile ? 'min-w-[120px] snap-start justify-center px-4 py-3' : 'min-w-0 max-w-[200px]'}
    ```

    This ensures tabs are touch-friendly on mobile.
  </action>
  <verify>DocumentTabs responsive on mobile</verify>
  <done>Updated DocumentTabs for mobile</done>
</task>

<task type="auto">
  <name>Update DocumentWorkspace for mobile</name>
  <files>apps/portal/src/components/DocumentWorkspace.tsx</files>
  <action>
    Update `apps/portal/src/components/DocumentWorkspace.tsx` for mobile:

    1. Import useResponsive:
    ```typescript
    import { useResponsive } from '../hooks/useResponsive';
    ```

    2. Add responsive hook call:
    ```typescript
    const { isMobile, isTablet } = useResponsive();
    ```

    3. Update grid layout for mobile:
    - Mobile: Single column stacked layout
    - Tablet: 2 columns (document + annotations)
    - Desktop: 2:1 ratio with optional references panel

    Modify the grid className in the content area:
    ```typescript
    <div className={`
      grid gap-4 h-full
      ${isMobile
        ? 'grid-cols-1'
        : isTablet || !showReferences
          ? 'grid-cols-1 lg:grid-cols-2'
          : 'grid-cols-1 lg:grid-cols-[2fr_1fr_20rem]'
      }
    `}>
    ```

    4. Make panels full-width on mobile:
    ```typescript
    // Document content panel className:
    className={`${isMobile ? 'p-4' : 'p-6 lg:col-span-2'}`}

    // Annotations panel className:
    className={`${isMobile ? 'p-4' : 'p-6 lg:col-span-1'}`}
    ```

    5. On mobile, hide reference panel by default and make it full-width when shown.

    This ensures the workspace is usable on mobile devices.
  </action>
  <verify>DocumentWorkspace responsive on mobile</verify>
  <done>Updated DocumentWorkspace for mobile</done>
</task>

</tasks>

<verification>
- [ ] useResponsive hook detects mobile/tablet/desktop breakpoints
- [ ] useMediaQuery hook for custom media queries
- [ ] useBreakpoint hook for breakpoint-based values
- [ ] MobileLayout component with header and nav
- [ ] MobileHeader with hamburger menu
- [ ] MobileNav bottom navigation bar
- [ ] DocumentTabs responsive with touch targets
- [ ] DocumentWorkspace stacks on mobile
- [ ] Grid layout adapts to screen size
</verification>

<success_criteria>
1. Interface functions correctly on mobile devices (MOBL-01)
2. Touch interactions work properly
3. Layout adapts to mobile (< 640px), tablet (640-1024px), desktop (> 1024px)
4. All components are responsive
</success_criteria>

---

**Plan created:** 2026-02-06
**Estimated duration:** 30 min
**Complexity:** Medium (responsive design, breakpoint detection, mobile UX)
